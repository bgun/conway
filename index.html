<!DOCTYPE html>
<html>
<head>
<title>Conway's Game of Life</title>
<script>

Util = {
  make_empty_matrix: function(w,h) {
    // just a matrix of 0's
    var m = [];
    for(var y = 0; y < h; y++) {
      m.push([]);
      for(var x = 0; x < w; x++) {
        m[y].push(0);
      }
    }
    return m;
  },
  overlay_matrix: function(m1,m2) {
    // copies m2 on top of m1 and returns the updated matrix
    var m3 = Util.make_empty_matrix(m1[0].length, m1.length);
    for(var y = 0; y < m1.length; y++) {
      for(var x = 0; x < m1[y].length; x++) {
        if(m2[y]) {
          if(m2[y][x]) {
            m3[y][x] = m2[y][x];
            continue;
          }
        }
        m3[y][x] = m1[y][x];
      }
    }
    return m3;
  }
};

App = {
  BLOCK_SIZE: 5,
  GRID_HEIGHT: 60,
  GRID_WIDTH: 80,
  TICK_TIME: 100,
  time: 0,
  matrix_state: [],
  tests: {
    blinker: [
      [0,0,0,0,0],
      [0,0,0,0,0],
      [0,1,1,1,0],
      [0,0,0,0,0],
      [0,0,0,0,0]
    ],
    glider: [
      [0,0,0,0,0],
      [0,1,0,0,0],
      [0,0,1,1,0],
      [0,1,1,0,0],
      [0,0,0,0,0]
    ],
    gosper_glider_gun: [
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0],
      [0,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,1,1,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,1,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
    ],
    pulsar: [
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
    ],
    big_grid: [
      [1,1,0,0,1,1,0,0,1,1,0,0],
      [1,1,0,0,1,1,0,0,1,1,0,0],
      [0,0,1,1,0,0,1,1,0,0,1,1],
      [0,0,1,1,0,0,1,1,0,0,1,1],
      [1,1,0,0,1,1,0,0,1,1,0,0],
      [1,1,0,0,1,1,0,0,1,1,0,0],
      [0,0,1,1,0,0,1,1,0,0,1,1],
      [0,0,1,1,0,0,1,1,0,0,1,1],
    ],
    grid: [
      [0,1,0,1,0,1,0,1,0,1],
      [1,0,1,0,1,0,1,0,1,0],
      [0,1,0,1,0,1,0,1,0,1],
      [1,0,1,0,1,0,1,0,1,0],
      [0,1,0,1,0,1,0,1,0,1],
      [1,0,1,0,1,0,1,0,1,0],
      [0,1,0,1,0,1,0,1,0,1],
      [1,0,1,0,1,0,1,0,1,0]
    ],
  }
};
App.game_of_life = function(m1) {
  // game function returns updated state of the binary matrix
  var n, m2 = Util.make_empty_matrix(m1[0].length, m1.length);
  for(var y = 0; y < m1.length; y++) {
    for(var x = 0; x < m1[y].length; x++) {
      n = 0;
      for(var a = y-1; a <= y+1; a++) {
        for(var b = x-1; b <= x+1; b++) {
          if((m1[a] && m1[a][b]) && (a != y || b != x)) { // only count neighbors, not myself
            n++;
          }
        }
      }
      if(n < 2 || n > 3) { // death by under- or over-population
        m2[y][x] = 0;
      } else if(n == 3) { // 3 neighbors = reproduction
        m2[y][x] = 1;
      } else if(n == 2) { // 2 neighbors = no change
        m2[y][x] = m1[y][x];
      }
    }
  }
  return m2;
};

App.draw = function(ctx) {
  ctx.fillStyle = 'lightgray';
  ctx.fillRect(0,0,App.board.width,App.board.height);
  ctx.fillStyle = 'black';
  var x,y;
  var b = App.BLOCK_SIZE;
  var t = App.time;
  for(y = 0; y < App.GRID_HEIGHT; y++) {
    for(x = 0; x < App.GRID_WIDTH; x++) {
      if(App.matrix_state[y][x]) {
        ctx.fillRect(x*b,y*b,b,b);
      }
    }
  }
};

App.animloop = function() {
  App.time++;
  setTimeout(App.animloop, App.TICK_TIME);
  App.matrix_state = App.game_of_life(App.matrix_state);
  App.draw(App.draw_context);
};

App.init = function() {
  App.board = document.getElementById('board');
  App.board.width = App.BLOCK_SIZE * App.GRID_WIDTH;
  App.board.height = App.BLOCK_SIZE * App.GRID_HEIGHT;

  if(App.board.getContext) {
    App.draw_context = App.board.getContext('2d');
  }

  // set up a test and lay it over our game board
  var test = App.tests.gosper_glider_gun;
  App.matrix_state = Util.make_empty_matrix(App.GRID_WIDTH, App.GRID_HEIGHT);
  App.matrix_state = Util.overlay_matrix(App.matrix_state, test);

  App.animloop();
};

</script>
</head>
<body onload="App.init();">
<canvas id="board"></canvas>
</body>
</html>
